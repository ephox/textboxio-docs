---
layout: default
title: Node.js Upload Handler
---

<p> The following script is a simple Node.js application that creates an HTTP server, and handles image uploads (multipart form posts) suitable for use with Textbox.io.Â Please note that this script is provided for your reference only.</p>
<pre class="theme: Confluence; brush: js; gutter: true" style="font-size:12px;">var http = require(&#39;http&#39;); var fs = require(&#39;fs&#39;); var multiparty = require(&#39;multiparty&#39;); // https://www.npmjs.com/package/multiparty // #### #### #### #### #### #### #### #### #### // Setup the Textbox.io Example Post Acceptor // #### #### #### #### #### #### #### #### #### // Set the URL and port for the post acceptor var acceptorPath = &#39;/upload&#39;; var acceptorPort = 8080; // Only these origins will be allowed to upload images var allowedOrigins = [&#39;http://localhost&#39;, &#39;http://192.168.1.1&#39;]; // Set the upload directory // Notw: This string is prepended to the filename to construct // the image url returned to the Textbox.io editor, like: uploadDirectory/filename.png var uploadDirectory = &#39;images/&#39;; // Set the resource URL for from which stored images will be served. var resourceUrl = &#39;http://localhost/&#39;; // #### #### #### #### #### #### #### #### #### // #### #### #### #### #### #### #### #### #### http.createServer(function(req, res) { var origin = req.headers.origin; if(allowedOrigins.indexOf(origin) == -1) { // Deny invalid origins res.writeHead(403, { &#39;HTTP/1.0 403 Origin Denied&#39; : origin }); res.end(); } else { // For valid origins check path and method if (req.url === acceptorPath &amp;&amp; req.method === &#39;POST&#39;) { var form = new multiparty.Form(); form.parse(req); form.on(&#39;file&#39;, function(name, file) { var saveFilePath = uploadDirectory + file.originalFilename; fs.rename(file.path, saveFilePath, function(err) { if (err) { // Handle problems with file saving res.writeHead(500); res.end(); } else { // Respond to the successful upload with JSON. // Use a location key to specify the path to the saved image resource. // { location : &#39;/your/uploaded/image/file&#39;} var textboxResponse = JSON.stringify({ location : saveFilePath }); // If your script needs to receive cookies, set images.upload.credentials:true in // the Textbox.io configuration and enable the following two headers. // res.setHeader(&#39;Access-Control-Allow-Credentials&#39;, &#39;true&#39;); // res.setHeader(&#39;P3P&#39;, &#39;CP=&quot;There is no P3P policy.&quot;&#39;); res.statusCode = 200; res.setHeader(&#39;Access-Control-Allow-Origin&#39;, origin); res.end(textboxResponse); } }); }); form.on(&#39;error&#39;, function(err) { res.writeHead(500); res.end(); }); return; } else { // Return 404 for requests for other paths/methods res.writeHead(404); res.end(); } } }).listen(acceptorPort);</pre>