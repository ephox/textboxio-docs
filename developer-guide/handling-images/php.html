---
layout: default
title: PHP Upload Handler
---

<p> The following script creates a server-side upload handler in PHP suitable for use with Textbox.io.</p>
<p>Please note that this script is provided for your reference - you'll need to update this as necessary for your application.</p>
<pre class="theme: Confluence; brush: php; gutter: true" style="font-size:12px;">&lt;?php /Applications /Developer-3.2.3 /Library /Network /System /Users /Volumes /bin /cores /demo-res /dev /ephox /etc /home /index.html /installer.failurerequests /lost+found /net /opt /private /recurly-client-php /sbin /tmp /usr /var STUFF cleaned export repaired src tbdocs-cleaned-1.zip tbdocs-formatted.zip titles working Only these origins will be allowed to upload images STUFF cleaned export repaired src tbdocs-cleaned-1.zip tbdocs-formatted.zip titles working cleaned/ export/ repaired/ src/ titles/ working/ $accepted_origins = array(&quot;http://localhost&quot;, &quot;http://192.168.1.1&quot;, &quot;http://example.com&quot;); /Applications /Developer-3.2.3 /Library /Network /System /Users /Volumes /bin /cores /demo-res /dev /ephox /etc /home /index.html /installer.failurerequests /lost+found /net /opt /private /recurly-client-php /sbin /tmp /usr /var STUFF cleaned export repaired src tbdocs-cleaned-1.zip tbdocs-formatted.zip titles working Change this line to set the upload folder STUFF cleaned export repaired src tbdocs-cleaned-1.zip tbdocs-formatted.zip titles working cleaned/ export/ repaired/ src/ titles/ working/ $imageFolder = &quot;images/&quot;; reset ($_FILES); $temp = current($_FILES); if (is_uploaded_file($temp[&#39;tmp_name&#39;])){ if (isset($_SERVER[&#39;HTTP_ORIGIN&#39;])) { // same-origin requests won&#39;t set an origin. If the origin is set, it must be valid. if (in_array($_SERVER[&#39;HTTP_ORIGIN&#39;], $accepted_origins)) { header(&#39;Access-Control-Allow-Origin: &#39; . $_SERVER[&#39;HTTP_ORIGIN&#39;]); } else { header(&quot;HTTP/1.0 403 Origin Denied&quot;); return; } } /Applications /Developer-3.2.3 /Library /Network /System /Users /Volumes /bin /cores /demo-res /dev /ephox /etc /home /index.html /installer.failurerequests /lost+found /net /opt /private /recurly-client-php /sbin /tmp /usr /var If your script needs to receive cookies, set images.upload.credentials:true in the Textbox.io configuration and enable the following two headers. cleaned/ export/ repaired/ src/ titles/ working/ // header(&#39;Access-Control-Allow-Credentials: true&#39;); // header(&#39;P3P: CP=&quot;There is no P3P policy.&quot;&#39;); // Sanitize input if (preg_match(&quot;/([^\w\s\d\-_~,;:\[\]\(\).])|([\.]{2,})/&quot;, $temp[&#39;name&#39;])) { header(&quot;HTTP/1.0 500 Invalid file name.&quot;); return; } // Verify extension if (!in_array(strtolower(pathinfo($temp[&#39;name&#39;], PATHINFO_EXTENSION)), array(&quot;gif&quot;, &quot;jpg&quot;, &quot;png&quot;))) { header(&quot;HTTP/1.0 500 Invalid extension.&quot;); return; } // Accept upload if there was no origin, or if it is an accepted origin $filetowrite = $imageFolder . $temp[&#39;name&#39;]; move_uploaded_file($temp[&#39;tmp_name&#39;], $filetowrite); // Respond to the successful upload with JSON. // Use a location key to specify the path to the saved image resource. // { location : &#39;/your/uploaded/image/file&#39;} echo json_encode(array(&#39;location&#39; =&gt; $filetowrite)); } else { // Notify Textbox.io editor that the upload failed header(&quot;HTTP/1.0 500 Server Error&quot;); } ?&gt;</pre>